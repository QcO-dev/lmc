{"version":3,"sources":["assembler.js","emulator.js","App.js","index.js"],"names":["INSTRUCTIONS","UNARY_INSTRUCTIONS","UNARY_INSTRUCTION_CODE_MAP","BINARY_INSTRUCTION_FIRST_VALUE","assemble","source","memory","Array","fill","lines","split","filter","v","length","map","l","i","replace","w","word","line","isNaN","parseInt","parseFloat","includes","type","value","match","toToken","toUpperCase","labels","ip","slice","words","flat","error","errorLoc","memoryAddress","instruction","opcode","operand","form","toString","padStart","step","inIp","registers","output","wasWaitingForInput","input","pc","strMemValue","data","ir","ar","halt","waitingForInput","ac","defaultString","join","App","editorRef","useRef","useState","setMemory","currentIp","setCurrentIp","setRegisters","setOutput","setError","setInput","setWaitingForInput","isHalted","setHalted","submitRef","loopRef","getColourBorder","condition","subcondition","stopCode","clearInterval","current","className","onClick","assembleResult","getValue","assembleCode","localMem","localReg","out","waiting","setInterval","height","width","theme","defaultValue","onMount","editor","_monaco","onSubmit","event","preventDefault","htmlFor","name","onChange","target","per10mem","chunk","push","values","j","renderMemory","regToName","Object","entries","register","style","minWidth","renderRegisters","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4dd686cb.chunk.js","sourcesContent":["// Returns the memory array\r\n\r\nconst INSTRUCTIONS = [\"LDA\", \"STA\", \"ADD\", \"SUB\", \"INP\", \"OUT\", \"HLT\", \"BRZ\", \"BRP\", \"BRA\", \"DAT\"];\r\nconst UNARY_INSTRUCTIONS = [\"INP\", \"OUT\", \"HLT\"];\r\n\r\nconst UNARY_INSTRUCTION_CODE_MAP = {\r\n\t\"INP\": 901,\r\n\t\"OUT\": 902,\r\n\t\"HLT\": 0\r\n}\r\n\r\nconst BINARY_INSTRUCTION_FIRST_VALUE = {\r\n\t\"LDA\": \"5\",\r\n\t\"STA\": \"3\",\r\n\t\"ADD\": \"1\",\r\n\t\"SUB\": \"2\",\r\n\t\"BRZ\": \"7\",\r\n\t\"BRP\": \"8\",\r\n\t\"BRA\": \"6\",\r\n\t\"DAT\": \"\"\r\n}\r\n\r\nconst toToken = (word, line) => {\r\n\tif(!isNaN(word) && parseInt(word) === parseFloat(word)) {\r\n\t\treturn {\r\n\t\t\ttype: \"int\",\r\n\t\t\tvalue: parseInt(word),\r\n\t\t\tline\r\n\t\t}\r\n\t}\r\n\telse if(INSTRUCTIONS.includes(word)) {\r\n\t\treturn {\r\n\t\t\ttype: \"instruction\",\r\n\t\t\tvalue: word,\r\n\t\t\tline\r\n\t\t}\r\n\t}\r\n\telse if(word.match(/^[A-Z][A-Z0-9]+$/)) {\r\n\t\treturn {\r\n\t\t\ttype: \"label\",\r\n\t\t\tvalue: word,\r\n\t\t\tline\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\treturn {\r\n\t\t\ttype: \"invalid\",\r\n\t\t\tvalue: word,\r\n\t\t\tline\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const assemble = (source) => {\r\n\tconst memory = new Array(100).fill(0);\r\n\r\n\tconst rawLines = source.split(/\\r?\\n/).filter(v => v.length !== 0);\r\n\r\n\tlet lines = rawLines.map((l, i) => l.replace(/\\/\\/.*?$/, \"\").split(/\\s+/).filter(v => v.length !== 0).map(w => toToken(w.toUpperCase(), i + 1)))\r\n\t\t\t\t.filter(l => l.length !== 0);\r\n\r\n\tconst labels = {}\r\n\tlet ip = 0;\r\n\tfor(let i = 0; i < lines.length; i++) {\r\n\t\tlet line = lines[i];\r\n\r\n\t\tif(line[0].type === \"label\") {\r\n\t\t\tlabels[line[0].value] = ip;\r\n\t\t\tlines[i] = line = line.slice(1)\r\n\t\t}\r\n\t\tip += line.filter(w => w.type === \"instruction\").length;\r\n\t}\r\n\tlines = lines.filter(l => l.length !== 0)\r\n\r\n\tconst words = lines.flat();\r\n\r\n\tfor(let word of words) {\r\n\t\tif(word.type === \"invalid\")\r\n\t\t\treturn {\r\n\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\terror: `Unexpected token ${word.value}`,\r\n\t\t\t\terrorLoc: word\r\n\t\t\t}\r\n\t}\r\n\r\n\tlet memoryAddress = 0;\r\n\tfor(let i = 0; i < words.length; i++) {\r\n\t\tconst word = words[i];\r\n\r\n\t\tif(word.type === \"instruction\") {\r\n\t\t\tconst instruction = word.value;\r\n\r\n\t\t\tif(UNARY_INSTRUCTIONS.includes(instruction)) {\r\n\t\t\t\tmemory[memoryAddress] = UNARY_INSTRUCTION_CODE_MAP[instruction];\r\n\t\t\t\tmemoryAddress++;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconst opcode = BINARY_INSTRUCTION_FIRST_VALUE[instruction];\r\n\r\n\t\t\t\tconst operand = words[i + 1];\r\n\r\n\t\t\t\tlet form = opcode;\r\n\r\n\t\t\t\tif(operand.type === \"int\") {\r\n\t\t\t\t\tif(instruction === \"DAT\")\r\n\t\t\t\t\t\tform = operand.value.toString()\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tform += operand.value.toString().padStart(2, '0')\r\n\t\t\t\t}\r\n\t\t\t\telse if(operand.type === \"label\") {\r\n\t\t\t\t\tif(!(operand.value in labels)) {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\t\t\t\terror: `Label ${operand.value} is not bound`,\r\n\t\t\t\t\t\t\terrorLoc: word\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(instruction === \"DAT\")\r\n\t\t\t\t\t\tform = labels[operand.value].toString()\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tform += labels[operand.value].toString().padStart(2, '0');\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\t\t\terror: `Expected value, got ${operand.value}`,\r\n\t\t\t\t\t\terrorLoc: word\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(form.length > 3) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\t\t\terror: `Values cannot exceed 3 digits (got ${form})`,\r\n\t\t\t\t\t\terrorLoc: word\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tmemory[memoryAddress] = parseInt(form)\r\n\t\t\t\tmemoryAddress++;\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn {\r\n\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\terror: `Expected instruction, got ${word.value}`,\r\n\t\t\t\terrorLoc: word\r\n\t\t\t}\r\n\t\t}\r\n\t\tif(memoryAddress > 99) {\r\n\t\t\treturn {\r\n\t\t\t\tmemory: new Array(100).fill(0),\r\n\t\t\t\terror: `Exceeded memory capacity of 100 @ ${word.value}`,\r\n\t\t\t\terrorLoc: word\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tmemory,\r\n\t\terror: null,\r\n\t\terrorLoc: null\r\n\t};\r\n}","export const step = (memory, inIp, registers, output, wasWaitingForInput, input) => {\r\n\tregisters.pc = inIp;\r\n\tconst memValue = memory[registers.pc++];\r\n\r\n\tconst strMemValue = memValue.toString().padStart(3, '0')\r\n\tconst instruction = parseInt(strMemValue[0])\r\n\tconst data = parseInt(strMemValue[1]) * 10 + parseInt(strMemValue[2])\r\n\r\n\tregisters.ir = instruction;\r\n\tregisters.ar = data;\r\n\r\n\tlet halt = false;\r\n\tlet waitingForInput = false;\r\n\r\n\tif(wasWaitingForInput && input) {\r\n\t\tregisters.ac = parseInt(input)\r\n\t}\r\n\r\n\tswitch(instruction) {\r\n\t\t// HLT\r\n\t\tcase 0:\r\n\t\t\thalt = true;\r\n\t\t\tbreak;\r\n\t\t// ADD\r\n\t\tcase 1:\r\n\t\t\tregisters.ac = registers.ac + memory[data];\r\n\t\t\tbreak;\r\n\t\t// SUB\r\n\t\tcase 2:\r\n\t\t\tregisters.ac = registers.ac - memory[data];\r\n\t\t\tbreak;\r\n\t\t// STA\r\n\t\tcase 3:\r\n\t\t\tmemory[data] = registers.ac;\r\n\t\t\tbreak;\r\n\t\t// LDA\r\n\t\tcase 5:\r\n\t\t\tregisters.ac = memory[data];\r\n\t\t\tbreak;\r\n\t\t// BRA\r\n\t\tcase 6:\r\n\t\t\tregisters.pc = data;\r\n\t\t\tbreak;\r\n\t\t// BRZ\r\n\t\tcase 7:\r\n\t\t\tif(registers.ac === 0)\r\n\t\t\t\tregisters.pc = data;\r\n\t\t\tbreak;\r\n\t\t// BRP\r\n\t\tcase 8:\r\n\t\t\tif(registers.ac >= 0)\r\n\t\t\t\tregisters.pc = data;\r\n\t\t\tbreak;\r\n\t\t// INP / OUT\r\n\t\tcase 9:\r\n\t\t\tif(data === 1) {\r\n\t\t\t\twaitingForInput = true;\r\n\t\t\t}\r\n\t\t\telse if(data === 2) {\r\n\t\t\t\toutput += registers.ac + \" \";\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\t// NOP\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn {\r\n\t\tmemory,\r\n\t\tip: registers.pc,\r\n\t\tregisters,\r\n\t\toutput,\r\n\t\thalt,\r\n\t\twaitingForInput\r\n\t}\r\n}","import './App.css';\n\nimport Editor from \"@monaco-editor/react\";\nimport { useRef, useState } from 'react';\nimport { assemble } from './assembler';\nimport { step } from './emulator';\n\nconst defaultString = [\n\t\"// Input two numbers, sum them, and output the result\",\n\t\"        INP\",\n\t\"        STA FIRST\",\n\t\"        INP\",\n\t\"        ADD FIRST\",\n\t\"        OUT\",\n\t\"        HLT\",\n\t\"FIRST   DAT 0\"\n].join(\"\\n\");\n\nfunction App() {\n\n\tconst editorRef = useRef(null);\n\n\tconst [memory, setMemory] = useState(Array(100).fill(0));\n\tconst [currentIp, setCurrentIp] = useState(0)\n\tconst [registers, setRegisters] = useState({\n\t\t\"pc\": 0,\n\t\t\"ir\": 0,\n\t\t\"ar\": 0,\n\t\t\"ac\": 0\n\t})\n\tconst [output, setOutput] = useState(\"\")\n\tconst [error, setError] = useState(\"\")\n\tconst [input, setInput] = useState(\"\")\n\tconst [waitingForInput, setWaitingForInput] = useState(false)\n\tconst [isHalted, setHalted] = useState(false)\n\tconst submitRef = useRef(null)\n\tconst loopRef = useRef(null)\n\n\tconst handleEditorDidMount = (editor, _monaco) => {\n\t\teditorRef.current = editor;\n\t}\n\n\tconst getColourBorder = (condition, subcondition) => {\n\t\tif (condition) {\n\t\t\tif (subcondition) {\n\t\t\t\treturn \"red-border\";\n\t\t\t}\n\t\t\treturn \"green-border\";\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tconst onInputChanged = (event) => {\n\t\tsetInput(event.target.value)\n\t}\n\n\tconst onInputSubmitted = (event) => {\n\t\tsubmitRef.current = input\n\t\tsetInput(\"\")\n\t\tevent.preventDefault()\n\t}\n\n\tconst assembleCode = () => {\n\t\tconst assembleResult = assemble(editorRef.current.getValue())\n\n\t\tif(!assembleResult.error) {\n\t\t\tsetMemory(assembleResult.memory)\n\t\t\tsetError(\"\")\n\t\t}\n\t\telse {\n\t\t\tsetError(`[${assembleResult.errorLoc.line}]: ${assembleResult.error}`)\n\t\t}\n\t}\n\n\tconst runCode = () => {\n\t\tif(error !== \"\") return;\n\t\tlet localMem = memory;\n\t\tlet ip = 0;\n\t\tlet localReg = {\n\t\t\t\"pc\": 0,\n\t\t\t\"ir\": 0,\n\t\t\t\"ar\": 0,\n\t\t\t\"ac\": 0\n\t\t};\n\t\tlet halt = false;\n\t\tlet out = \"\"\n\n\t\tlet waiting = false\n\t\tloopRef.current = setInterval(() => {\n\t\t\tif (waiting && !submitRef.current)\n\t\t\t\treturn;\n\t\t\t({ memory: localMem, ip, registers: localReg, halt, output: out, waitingForInput: waiting } = step(localMem, ip, localReg, out, waiting, submitRef.current))\n\t\t\tif (submitRef.current)\n\t\t\t\tsubmitRef.current = null\n\n\t\t\tif (halt || ip >= 100) {\n\t\t\t\tclearInterval(loopRef.current)\n\t\t\t\tloopRef.current = null\n\t\t\t}\n\n\t\t\tif (ip >= 100) ip = 99;\n\t\t\tsetCurrentIp(ip)\n\t\t\tsetRegisters(localReg)\n\t\t\tsetMemory(localMem)\n\t\t\tsetOutput(out)\n\t\t\tsetWaitingForInput(waiting)\n\t\t\tsetHalted(halt)\n\t\t}, 1000 / 60)\n\t}\n\n\tconst stopCode = () => {\n\t\tclearInterval(loopRef.current)\n\t}\n\n\tconst stepCode = () => {\n\t\tif(error !== \"\") return;\n\t\tclearInterval(loopRef.current)\n\n\t\tif (waitingForInput && !submitRef.current)\n\t\t\treturn;\n\t\tif (isHalted || currentIp >= 100)\n\t\t\treturn;\n\n\t\tlet localMem = memory;\n\t\tlet ip = currentIp;\n\t\tlet localReg = registers;\n\t\tlet halt = isHalted;\n\t\tlet out = \"\"\n\n\t\tlet waiting = waitingForInput;\n\n\t\t({ memory: localMem, ip, registers: localReg, halt, output: out, waitingForInput: waiting } = step(localMem, ip, localReg, out, waiting, submitRef.current))\n\t\tif (submitRef.current)\n\t\t\tsubmitRef.current = null\n\n\t\tif (halt || ip >= 100) {\n\t\t\tclearInterval(loopRef.current)\n\t\t\tloopRef.current = null\n\t\t}\n\n\t\tif (ip >= 100) ip = 99;\n\t\tsetCurrentIp(ip)\n\t\tsetRegisters(localReg)\n\t\tsetMemory(localMem)\n\t\tsetOutput(out)\n\t\tsetWaitingForInput(waiting)\n\t\tsetHalted(halt)\n\t}\n\n\tconst reset = () => {\n\t\tstopCode()\n\t\tassembleCode()\n\t\tsetCurrentIp(0)\n\t\tsetRegisters({\n\t\t\t\"pc\": 0,\n\t\t\t\"ir\": 0,\n\t\t\t\"ar\": 0,\n\t\t\t\"ac\": 0\n\t\t})\n\t\tsetOutput(\"\")\n\t\tsetWaitingForInput(false)\n\t\tsetHalted(false)\n\t}\n\n\tconst renderMemory = () => {\n\t\tconst per10mem = [];\n\t\tfor (let i = 0; i < memory.length; i += 10) {\n\t\t\tconst chunk = memory.slice(i, i + 10);\n\t\t\tper10mem.push(chunk);\n\t\t}\n\n\t\treturn per10mem.map((values, i) => {\n\t\t\treturn <div className=\"memory-row\" key={\"memory\" + i}>\n\t\t\t\t<p className=\"memory-item\">{i * 10}: </p>\n\t\t\t\t<>{\n\t\t\t\t\tvalues.map((value, j) => <p className={`memory-item ${getColourBorder(i * 10 + j === currentIp, isHalted)}`} key={\"item\" + i * 10 + j}>{value}</p>)\n\t\t\t\t}</>\n\t\t\t</div>\n\t\t})\n\t}\n\n\tconst renderRegisters = () => {\n\t\tconst regToName = {\n\t\t\t\"pc\": \"Program Counter\",\n\t\t\t\"ir\": \"Instruction\",\n\t\t\t\"ar\": \"Address\",\n\t\t\t\"ac\": \"Accumulator\"\n\t\t}\n\n\t\treturn Object.entries(registers).map(([register, value]) => <p style={{ minWidth: regToName[register].length + 2 + 3 + \"ch\" }} className={getColourBorder(register === \"pc\", isHalted)} key={register}>{regToName[register]}: {value}</p>)\n\t}\n\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<h1 className=\"title\">Little Man Computer</h1>\n\t\t\t<div className=\"buttons\">\n\t\t\t\t<button onClick={reset}>Assemble To RAM (reset)</button>\n\t\t\t\t<button onClick={runCode}>Run</button>\n\t\t\t\t<button onClick={() => { if(error !== \"\") return; stopCode(); setHalted(true); }}>Stop</button>\n\t\t\t\t<button onClick={stepCode}>Step</button>\n\t\t\t</div>\n\t\t\t<main>\n\t\t\t\t<Editor height=\"90vh\" width=\"45vw\" theme=\"vs-dark\" defaultValue={defaultString} onMount={handleEditorDidMount} />\n\t\t\t\t<div className=\"monitor\">\n\t\t\t\t\t<form onSubmit={onInputSubmitted} className=\"input-form\">\n\t\t\t\t\t\t<label htmlFor=\"ioinput\" className={waitingForInput ? \"green-border\" : \"\"}>Input</label>\n\t\t\t\t\t\t<input type=\"text\" name=\"ioinput\" value={input} onChange={onInputChanged} />\n\t\t\t\t\t</form>\n\t\t\t\t\t<div className=\"mem-reg-container\">\n\t\t\t\t\t\t<div className=\"memory\">\n\t\t\t\t\t\t\t<h2>Memory</h2>\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{renderMemory()}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"registers\">\n\t\t\t\t\t\t\t<h2>Registers</h2>\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{renderRegisters()}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"output-box\">\n\t\t\t\t\t\t<h2>Output</h2>\n\t\t\t\t\t\t<p className={`output ${error !== \"\" ? \"error-output\" : \"\"}`}>\n\t\t\t\t\t\t\t{error === \"\" ? output : error}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}